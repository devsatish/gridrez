<div class="upload-shell">
  <div
    class="dropzone"
    [class.state-idle]="state === 'idle'"
    [class.state-dragging]="state === 'dragging'"
    [class.state-uploading]="state === 'uploading'"
    [class.state-processing]="state === 'processing'"
    [class.state-error]="state === 'error'"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
  >
    <input
      #fileInput
      type="file"
      class="file-input"
      accept=".pdf,.txt,.docx"
      (change)="onFileInputChange($event)"
    />

    <!-- Idle State -->
    <ng-container *ngIf="state === 'idle' && !selectedFile">
      <div class="upload-icon-button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <path d="M14 2v6h6"/>
          <path d="M12 18v-6"/>
          <path d="M9 15l3-3 3 3"/>
        </svg>
      </div>
      <p class="upload-title">Drop your resume here</p>
      <p class="upload-subtitle">
        or <span class="browse-link" (click)="fileInput.click(); $event.stopPropagation()">browse to choose a file</span>
      </p>
      <p class="upload-info">Supports PDF, DOCX, TXT • Max 10MB</p>
    </ng-container>

    <!-- Dragging State -->
    <ng-container *ngIf="state === 'dragging'">
      <div class="upload-icon-button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <path d="M14 2v6h6"/>
          <path d="M12 18v-6"/>
          <path d="M9 15l3-3 3 3"/>
        </svg>
      </div>
      <p class="upload-title">Drop your resume here</p>
    </ng-container>

    <!-- Selected File (before upload) -->
    <ng-container *ngIf="state === 'idle' && selectedFile">
      <div class="upload-icon-button">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      </div>
      <p class="upload-title">{{ selectedFile.name }}</p>
      <p class="upload-subtitle">{{ formatFileSize(selectedFile.size) }}</p>
    </ng-container>

    <!-- Uploading State -->
    <ng-container *ngIf="state === 'uploading'">
      <div class="upload-icon-button">
        <svg class="spinning" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle class="opacity-25" cx="12" cy="12" r="10"/>
          <path class="opacity-75" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
        </svg>
      </div>
      <p class="upload-title">Uploading...</p>
      <p class="upload-subtitle">{{ selectedFile?.name }} · {{ selectedFile ? formatFileSize(selectedFile.size) : '' }}</p>
    </ng-container>

    <!-- Processing State -->
    <ng-container *ngIf="state === 'processing'">
      <div class="upload-icon-button">
        <svg class="pulsing" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
        </svg>
      </div>
      <p class="upload-title">Analyzing resume with AI...</p>
      <p class="upload-subtitle">{{ selectedFile?.name }} · {{ selectedFile ? formatFileSize(selectedFile.size) : '' }}</p>
      <p class="upload-note">This may take a moment</p>
    </ng-container>

    <!-- Error State -->
    <ng-container *ngIf="state === 'error'">
      <div class="upload-icon-button error">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      </div>
      <p class="upload-error">{{ errorMessage }}</p>
      <p class="upload-subtitle">Click to try again</p>
    </ng-container>
  </div>
</div>
